<template>
  <qas-form-view
    v-model="values"
    v-model:errors="errors"
    v-model:fields="fields"
    entity="<%= props.name %>"
    :mode="mx_mode"
    @submit-success="submitSuccess"
  >
    <template #header>
      <qas-page-header
        :breadcrumbs="breadcrumbs"
        title="__MUDAR__NOME__"
      />
    </template>
    <template #default>
      <qas-form-generator
        v-model="values"
        :errors="errors"
        :fields="fields"
      />
    </template>
  </qas-form-view>
</template>

<script>
<%_ if(props.type === 'all'){ _%>
import { filterListByHandle, formMixin } from 'asteroid'
<%_ } else{ _%>
import { formMixin } from 'asteroid'
<%_ } _%>

export default {
  name: '<%= props.formName %>',

  mixins: [formMixin],

  data () {
    return {
      errors: {},
      fields: {},
      values: {}
    }
  },

  computed: {
    breadcrumbs () {
      return [
        { label: 'Lista de __MUDAR__NOME__', route: { name: '<%= props.listName %>' } },
        <%_ if(props.type === 'all'){ _%>
        ...filterListByHandle([
          {
            handle: this.mx_isEditMode,
            item: { label: '__MUDAR__NOME__', route: { name: '<%= props.singleName %>', params: { id: this.values.uuid } } }
          }
        ]),
        { label: this.mx_isEditMode ? 'Editar' : 'Criar __MUDAR__NOME__' }
        <%_ } else if (props.type === 'edit'){ _%>
        { label: '__MUDAR__NOME__', route: { name: '<%= props.singleName %>', params: { id: this.values.uuid } } },
        { label: 'Editar __MUDAR__NOME__' }
        <%_ } else { _%>
        { label: 'Criar __MUDAR__NOME__' }
        <%_ } _%>
      ]
    }
  },

  methods: {
    redirect (id) {
      return this.$router.push({ name: '<%= props.singleName %>', params: { id } })
    },

    submitSuccess ({ data }) {
      const id = data.metadata?.uuid || data.result?.uuid

      this.redirect(id)
    }
  }
}
</script>
