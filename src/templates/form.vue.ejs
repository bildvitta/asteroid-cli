<template>
  <qas-form-view v-model="values" v-model:errors="errors" v-model:fields="fields" entity="<%= props.name %>" :mode="mx_mode" @submit-success="submitSuccess">
    <template #header>
      <qas-page-header :breadcrumbs="breadcrumbs" title="__MUDAR__NOME__">
        <!-- TODO: Irá ter esse botão na página de formulário? definir padrão com os designers -->
        <!-- <settings-menu v-if="$_isEditMode" :custom-id="values.uuid" delete-label="Excluir" entity="<%= props.name %>" @delete-success="deleteSuccess" /> -->
      </qas-page-header>
    </template>
    <template #default>
      <qas-form-generator v-model="values" :errors="errors" :fields="fields" />
    </template>
  </qas-form-view>
</template>

<script>
import { filterListByHandle, formMixin } from 'asteroid'

export default {
  name: '<%= props.formName %>',

  mixins: [formMixin],

  data () {
    return {
      errors: {},
      fields: {},
      values: {}
    }
  },

  computed: {
    breadcrumbs () {
      return [
        { label: 'Lista de __MUDAR__NOME__', route: { name: '<%= props.listName %>' } },
        ...filterListByHandle([
          {
            handle: this.mx_isEditMode,
            item: { label: '__MUDAR__NOME__', route: { name: '<%= props.singleName %>', params: { id: this.values.uuid } } }
          }
        ]),
        { label: this.mx_isEditMode ? 'Editar' : 'Criar __MUDAR__NOME__' }
      ]
    }
  },

  methods: {
    redirect (id) {
      return this.$router.push({ name: '<%= props.singleName %>', params: { id } })
    },

    submitSuccess ({ data }) {
      const id = data.metadata?.uuid || data.result?.uuid

      this.redirect(id)
    },

    deleteSuccess () {
      this.$router.push({ name: '<%= props.listName %>' })
    }
  }
}
</script>

<style lang="scss">
.page-<%= props.name %>-form {}
</style>
